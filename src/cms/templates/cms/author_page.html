{% extends "cms/base.html" %}

{% load i18n %}
{% load staticfiles %}
{% load wagtailcore_tags %}
{% load wagtailimages_tags %}
{% load cms_tags %}

{% block css %}{{block.super}}
<link rel="stylesheet" href="{% static 'vendor/ol/css/ol.css' %}" type="text/css">
{% endblock %}

{% block js %}{{block.super}}
<script src="{% static 'vendor/ol/js/ol.js' %}"></script>
<script src="{% static 'js/cms/static-map.js' %}"></script>
{% endblock %}

{% block content_heading_title %}
<div class="row my-4">
  <div class="col-12">
    <h1><i class="fas fa-feather"></i> {{ author_name }}{%if author_name.i18n_birth_name %} ({% trans 'born' %} {{author_name.i18n_birth_name}}){% endif %}</h1>
    {% if author_alt_names %}
    <p>{% trans 'Also known as' %}: {{ author_alt_names|join:" || " }}
    </p>
    {% endif %}

  </div>
</div>
{% endblock %}

{% block content_main %}
<div class="row my-4">
  {% include "cms/includes/author.html" with author=page %}
</div>

{% if memorial_sites %}
<div class="row my-4">
  <div class="col-12">
    <h2>{% trans 'Memorial sites' %}</h2>
  </div>
  {% for memorial_site in memorial_sites %}
  {% with location=memorial_site.get_parent.specific %}
  <div class="col-lg-6">
    <div class="card">
      <div id="map-{{forloop.counter}}" class="card-img-top"></div>
      <div class="card-body p-2">
        <div class="row">
          <div class="{% if memorial_site.title_image %}col-8{% else %}col-12{% endif %}">
            <h5 class="card-title"><i class="fas fa-sign"></i> <a href="{% cmsurl memorial_site %}">{{ memorial_site }}</a></h5>
            <p>{{ memorial_site.i18n_introduction|richtext }}</p>
            <p><i class="fas fa-map-marker"></i> <a href="{% cmsurl location %}">{{ location }}</a></p>
          </div>
          {% if memorial_site.title_image %}
          <div class="col-4">
            {% image memorial_site.title_image fill-200x200 as title_image %}
            <img src="{{ title_image.url }}" class="figure-img img-fluid rounded" alt="{{ title_image.alt }}">
          </div>
          {% endif %}
        </div>
      </div>
    </div>
    <script>
      (function() {
        const mapId = "map-{{forloop.counter}}"
        const geojson = '{{ location.coordinates.geojson|safe }}'
        const coordinates = JSON.parse(geojson).coordinates;
        createStaticMap(mapId, coordinates, "{% static 'icons/castle.png' %}");
      })();
      </script>
  </div>
  {% endwith %}
  {% endfor %}
</div>
{% endif %}

<div class="row my-4">
  <div class="col-12">
    {% include 'cms/includes/levels.html' with levels=levels %}
  </div>
</div>
{% endblock %}
