{% extends "cms/base.html" %}

{% load i18n %}
{% load staticfiles %}
{% load wagtailcore_tags %}
{% load wagtailimages_tags %}

{% load cms_tags %}

{% block css %}{{block.super}}
<link rel="stylesheet" href="{% static 'vendor/ol/css/ol.css' %}" type="text/css">
{% endblock %}

{% block js %}{{block.super}}
<script src="{% static 'vendor/ol/js/ol.js' %}"></script>
<script src="{% static 'js/cms/static-map.js' %}"></script>
{% endblock %}

{% block content_main %}
<div class="row">

  <div class="col-12">
    <div class="row">
        <div class="col lead">
          {{self.i18n_introduction|safe}}
        </div>
        <div class="col-4">
          {% image page.title_image max-400x400 as tmp_image %}
          <figure class="figure w-100">
            <img src="{{ tmp_image.url }}" class="figure-img img-fluid" alt="{{ tmp_image.alt }}">
            <figcaption class="figure-caption">{{ tmp_image.image.i18n_caption }}</figcaption>
          </figure>
        </div>
      </div>
  </div>

  <div class="col-12">
    <h2>{% trans 'How to find it' %}</h2>
    <div class="row">
      <div class="col-6">
          {{self.i18n_contact_info|safe}}
          <address class="text-monospace">
            {{self.i18n_address|safe}}
          </address>
          {{self.i18n_directions|safe}}
      </div>
      <div class="col-6">
        <div class="card mb-2">
          <div id="map" class="card-img-top"></div>
        </div>
        <script>
        (function() {
          const mapId = "map"
          const geojson = '{{ self.coordinates.geojson|safe }}'
          if (geojson) {
            const coordinates = JSON.parse(geojson).coordinates;
            createStaticMap(mapId, coordinates, "{% static 'icons/castle.png' %}");
          }
        })();
        </script>
      </div>
    </div>
  </div>

  {% if self.i18n_description %}
  <div class="col-12">
    <h2>{% trans 'Introduction' %}</h2>
    {% include_block self.i18n_description %}
  </div>
  {% endif %}

  {% if self.i18n_detailed_description %}
  <div class="col-12">
    <h2>{% trans 'Delving deeper' %}</h2>
    {% include_block self.i18n_detailed_description %}
  </div>
  {% endif %}

  <div class="col-12">
    <h2>{% trans 'More about the author' %}</h2>
    <ul class="list-unstyled lead">
    {% for referenced_author in self.authors.all %}
      <li><a href="{% cmsurl referenced_author.author %}">{{referenced_author.author}}</a></li>
    {% endfor %}
    </ul>
  </div>
</div>
{% endblock %}
